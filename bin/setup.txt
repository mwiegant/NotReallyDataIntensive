###########################
# Setting up EC2 Instance #
###########################

# install nvm first
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.34.0/install.sh | bash

# activate nvm
. ~/.nvm/nvm.sh

# install node
nvm install node

# prep for installing mongo; must make the file and move it, or else we deal with write-protected issues
sudo cat >> mongodb-org-4.2.repo << EOF
[mongodb-org-4.2]
name=MongoDB Repository
baseurl=https://repo.mongodb.org/yum/amazon/2013.03/mongodb-org/4.2/x86_64/
gpgcheck=1
enabled=1
gpgkey=https://www.mongodb.org/static/pgp/server-4.2.asc
EOF

sudo cp mongodb-org-4.2.repo /etc/yum.repos.d/mongodb-org-4.2.repo

# install mongo
sudo yum install -y mongodb-org

# post-install setup for mongo
sudo mkdir /data
sudo mkdir /data/db
sudo chmod 777 /data/db

# post-post-install setup for mongo (setup database / collections)
mongod &
mongo
use dnd;
db.createCollection("encounters");
db.createCollection("units");
db.createCollection("hostiles");
exit
kill -2 `pgrep mongo`

# install git
sudo yum install git
git config --global user.name "mwiegant"

# install the source code
git clone https://github.com/mwiegant/avarrocka.git
cd avarrocka
npm install
cd ~

# start the server
mongod &
node avarrocka/bin/www



